Simple text editor

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define MAX_LEN 1000000

typedef struct {
    int type;
    char *data;
} Operation;

int main() {
    int Q;
    scanf("%d", &Q);

    char *S = calloc(MAX_LEN, sizeof(char));
    int len = 0;

    Operation *stack = malloc(Q * sizeof(Operation));
    int top = -1;

    for (int i = 0; i < Q; i++) {
        int op;
        scanf("%d", &op);

        if (op == 1) {
            char w[1000001];
            scanf("%s", w);
            int wlen = strlen(w);
            strcpy(S + len, w);
            len += wlen;
            stack[++top].type = 1;
            stack[top].data = strdup(w);
        } else if (op == 2) {
            int k;
            scanf("%d", &k);
            char *deleted = malloc((k + 1) * sizeof(char));
            strncpy(deleted, S + len - k, k);
            deleted[k] = '\0';
            len -= k;
            S[len] = '\0';
            stack[++top].type = 2;
            stack[top].data = deleted;
        } else if (op == 3) {
            int k;
            scanf("%d", &k);
            printf("%c\n", S[k - 1]);
        } else if (op == 4) {
            if (top >= 0) {
                Operation last = stack[top--];
                if (last.type == 1) {
                    int removeLen = strlen(last.data);
                    len -= removeLen;
                    S[len] = '\0';
                } else if (last.type == 2) {
                    int addLen = strlen(last.data);
                    strcpy(S + len, last.data);
                    len += addLen;
                }
                free(last.data);
            }
        }
    }

    free(S);
    free(stack);
    return 0;
}
